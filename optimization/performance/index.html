<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover"><title>关键渲染路径 | Oops的笔记</title><meta name="description" content="一些前端知识笔记"><meta charset="utf-8"><meta name="generator" content="VuePress 2.0.0-beta.22">
    <link rel="modulepreload" href="/assets/app.d8cb38ab.js"><link rel="modulepreload" href="/assets/index.html.75f8fa76.js"><link rel="modulepreload" href="/assets/index.html.ed50119f.js">
    <link rel="stylesheet" href="/assets/style.8c3d2604.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="toggle-sidebar-button"><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><span><a href="/" class=""><img class="logo" src="https://vuejs.org/images/logo.png" alt="Oops的笔记"><span class="site-name can-hide">Oops的笔记</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="前端知识体系"><span class="title">前端知识体系</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="前端知识体系"><span class="title">前端知识体系</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/frontEnd/javaScript/" class="nav-link" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/frontEnd/css/" class="nav-link" aria-label="CSS"><!--[--><!--]--> CSS <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/frontEnd/bom/" class="nav-link" aria-label="BOM"><!--[--><!--]--> BOM <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="浏览器相关"><span class="title">浏览器相关</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="浏览器相关"><span class="title">浏览器相关</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/browser/principle/" class="nav-link" aria-label="浏览器工作原理与实践"><!--[--><!--]--> 浏览器工作原理与实践 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="数据结构与算法"><span class="title">数据结构与算法</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="数据结构与算法"><span class="title">数据结构与算法</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/algorithm/leetCode/" class="nav-link" aria-label="LeetCode"><!--[--><!--]--> LeetCode <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/algorithm/sort/" class="nav-link" aria-label="排序算法"><!--[--><!--]--> 排序算法 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/algorithm/exercises/" class="nav-link" aria-label="算法练习"><!--[--><!--]--> 算法练习 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="工程化"><span class="title">工程化</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="工程化"><span class="title">工程化</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>webpack</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/engineering/webpack/" class="nav-link" aria-label="webpack 概念"><!--[--><!--]--> webpack 概念 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/engineering/webpack/webpack4/" class="nav-link" aria-label="webpack 4"><!--[--><!--]--> webpack 4 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="性能优化"><span class="title">性能优化</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="性能优化"><span class="title">性能优化</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a aria-current="page" href="/optimization/performance/" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="关键渲染路径"><!--[--><!--]--> 关键渲染路径 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="网络"><span class="title">网络</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="网络"><span class="title">网络</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/network/" class="nav-link" aria-label="网络分层模型"><!--[--><!--]--> 网络分层模型 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/network/http" class="nav-link" aria-label="HTTP"><!--[--><!--]--> HTTP <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/network/tcp-udp" class="nav-link" aria-label="TCP &amp; UDP"><!--[--><!--]--> TCP &amp; UDP <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="其他"><span class="title">其他</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="其他"><span class="title">其他</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/other/handCoding/" class="nav-link" aria-label="Hand Coding"><!--[--><!--]--> Hand Coding <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/other/regex/" class="nav-link" aria-label="正则表达式"><!--[--><!--]--> 正则表达式 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/other/git/" class="nav-link" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Interview"><span class="title">Interview</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Interview"><span class="title">Interview</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/interview/browser/" class="nav-link" aria-label="浏览器"><!--[--><!--]--> 浏览器 <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><div class="sidebar-mask"></div><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="前端知识体系"><span class="title">前端知识体系</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="前端知识体系"><span class="title">前端知识体系</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/frontEnd/javaScript/" class="nav-link" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/frontEnd/css/" class="nav-link" aria-label="CSS"><!--[--><!--]--> CSS <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/frontEnd/bom/" class="nav-link" aria-label="BOM"><!--[--><!--]--> BOM <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="浏览器相关"><span class="title">浏览器相关</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="浏览器相关"><span class="title">浏览器相关</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/browser/principle/" class="nav-link" aria-label="浏览器工作原理与实践"><!--[--><!--]--> 浏览器工作原理与实践 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="数据结构与算法"><span class="title">数据结构与算法</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="数据结构与算法"><span class="title">数据结构与算法</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/algorithm/leetCode/" class="nav-link" aria-label="LeetCode"><!--[--><!--]--> LeetCode <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/algorithm/sort/" class="nav-link" aria-label="排序算法"><!--[--><!--]--> 排序算法 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/algorithm/exercises/" class="nav-link" aria-label="算法练习"><!--[--><!--]--> 算法练习 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="工程化"><span class="title">工程化</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="工程化"><span class="title">工程化</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>webpack</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/engineering/webpack/" class="nav-link" aria-label="webpack 概念"><!--[--><!--]--> webpack 概念 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/engineering/webpack/webpack4/" class="nav-link" aria-label="webpack 4"><!--[--><!--]--> webpack 4 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="性能优化"><span class="title">性能优化</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="性能优化"><span class="title">性能优化</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a aria-current="page" href="/optimization/performance/" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="关键渲染路径"><!--[--><!--]--> 关键渲染路径 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="网络"><span class="title">网络</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="网络"><span class="title">网络</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/network/" class="nav-link" aria-label="网络分层模型"><!--[--><!--]--> 网络分层模型 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/network/http" class="nav-link" aria-label="HTTP"><!--[--><!--]--> HTTP <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/network/tcp-udp" class="nav-link" aria-label="TCP &amp; UDP"><!--[--><!--]--> TCP &amp; UDP <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="其他"><span class="title">其他</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="其他"><span class="title">其他</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/other/handCoding/" class="nav-link" aria-label="Hand Coding"><!--[--><!--]--> Hand Coding <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/other/regex/" class="nav-link" aria-label="正则表达式"><!--[--><!--]--> 正则表达式 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/other/git/" class="nav-link" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Interview"><span class="title">Interview</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Interview"><span class="title">Interview</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/interview/browser/" class="nav-link" aria-label="浏览器"><!--[--><!--]--> 浏览器 <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item">关键渲染路径</p><ul class=""><li><!--[--><a aria-current="page" href="/optimization/performance/#_1-构建dom" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="1. 构建DOM"><!--[--><!--]--> 1. 构建DOM <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/optimization/performance/#_2-构建cssom" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="2. 构建CSSOM"><!--[--><!--]--> 2. 构建CSSOM <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/optimization/performance/#_3-构建渲染树" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="3. 构建渲染树"><!--[--><!--]--> 3. 构建渲染树 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/optimization/performance/#_4-布局" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="4. 布局"><!--[--><!--]--> 4. 布局 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/optimization/performance/#_5-绘制" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="5. 绘制"><!--[--><!--]--> 5. 绘制 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/optimization/performance/#_6-js与关键渲染路径" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="6. JS与关键渲染路径"><!--[--><!--]--> 6. JS与关键渲染路径 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/optimization/performance/#_7-总结" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="7. 总结"><!--[--><!--]--> 7. 总结 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="关键渲染路径" tabindex="-1"><a class="header-anchor" href="#关键渲染路径" aria-hidden="true">#</a> 关键渲染路径</h1><p>浏览器将<u>HTML</u>，<u>CSS</u>，<u>JavaScript</u>转换为屏幕上所呈现的实际像素，这期间所经历的一系列步骤，叫做<strong>关键渲染路径</strong>（Critical Rendering Path）。</p><p>关键渲染路径的具体步骤：</p><p><img src="https://i.loli.net/2021/08/06/Sic9roJMzpl14vq.png" alt="image.png"></p><ol><li>浏览器获取<code>HTML</code>并开始构建<code>DOM</code>（文档对象模型 - Document Object Model）</li><li>获取<code>CSS</code>并构建<code>CSSOM</code>（CSS对象模型 - CSS Object Model）</li><li>然后将<code>DOM</code>与<code>CSSOM</code>结合，创建渲染树（Render Tree）</li><li>然后找到所有内容都处于网页的哪个位置，也就是布局（Layout）</li><li>最后，浏览器开始在屏幕上绘制像素</li></ol><h2 id="_1-构建dom" tabindex="-1"><a class="header-anchor" href="#_1-构建dom" aria-hidden="true">#</a> 1. 构建DOM</h2><p>构建DOM的具体步骤：<img src="https://i.loli.net/2021/08/06/N9uQS1VvcnXxao7.png" alt="image.png"></p><ol><li><p>第一步（<strong>转换</strong>）：浏览器从磁盘或网络读取HTML的原始字节，并根据文件的指定编码（例如 UTF-8）将它们转换成字符</p><p><img src="https://i.loli.net/2021/08/06/I8Kf5P9sWqwzyil.png" alt="image.png"></p></li><li><p>第二步（<strong>Token化</strong>）：将字符串转换成Token，例如：<code>&lt;html&gt;</code>、<code>&lt;body&gt;</code>等。Token中会标识出当前Token是“开始标签”或是“结束标签”亦或是“文本”等信息。</p><p>将字符串转换成Token：</p><p><img src="https://i.loli.net/2021/08/06/mDtkI7Kj8hGQfL5.png" alt="image.png"></p><p>节点之间的关系：</p><p><img src="https://i.loli.net/2021/08/06/k5Kz9ZjqQ7DVHPy.png" alt="image.png"></p></li><li><p>第三步（<strong>生成节点对象并构建DOM</strong>）：事实上，构建DOM的过程中，不是等所有Token都转换完成后再去生成节点对象，而是一边生成Token一边消耗Token来生成节点对象。换句话说，每个Token被生成后，会立刻消耗这个Token创建出节点对象。</p><blockquote><p><em>带有结束标签标识的Token不会创建节点对象</em></p></blockquote><p>节点对象包含了这个节点的所有属性。例如<code>&lt;img src=&quot;xxx.png&quot; /&gt;</code>标签最终生成出的节点对象中会保存图片地址等信息。</p><p>随后通过“开始标签”与“结束标签”来识别并关联节点之间的关系。最终，当所有Token都生成并消耗完毕后，我们就得到了一颗完整的DOM树。</p><p>从Token生成DOM的过程：</p><p><img src="https://i.loli.net/2021/08/06/O5vwWhjclXpA8rV.png" alt="image.png"></p><p>图中每一个虚线上有一个小数字，表示构建DOM的具体步骤。</p><ol><li>首先生成出<code>html</code>Token，并消耗Token创建出html节点对象。</li><li>然后生成<code>head</code>Token并消耗Token创建出head节点对象，并将它关联到html节点对象的子节点中。</li><li>随后生成<code>title</code>Token并消耗Token创建出title节点对象并将它关联到head节点对象的子节点中。</li><li>最后生成<code>body</code>Token并消耗Token创建body节点对象并将它关联到html的子节点中。</li><li>当所有Token都消耗完毕后，我们就得到了一颗完整的DOM树。</li></ol></li></ol><h2 id="_2-构建cssom" tabindex="-1"><a class="header-anchor" href="#_2-构建cssom" aria-hidden="true">#</a> 2. 构建CSSOM</h2><p>构建CSSOM的过程与构建DOM的过程非常相似，当浏览器接收到一段CSS，浏览器首先要做的是识别出Token，然后构建节点并生成CSSOM。</p><p>构建CSSOM的具体过程：</p><p><img src="https://i.loli.net/2021/08/06/XlK5VsZP8nMhfLu.png" alt="image.png"></p><div class="language-css ext-css"><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F92672;">body</span><span style="color:#F8F8F2;"> {</span><span style="color:#66D9EF;font-style:italic;">font-size</span><span style="color:#F8F8F2;">: </span><span style="color:#AE81FF;">16</span><span style="color:#F92672;">px</span><span style="color:#F8F8F2;">;}</span></span>
<span class="line"><span style="color:#F92672;">p</span><span style="color:#F8F8F2;"> {</span><span style="color:#66D9EF;font-style:italic;">color</span><span style="color:#F8F8F2;">: </span><span style="color:#66D9EF;">red</span><span style="color:#F8F8F2;">;}</span></span>
<span class="line"><span style="color:#F92672;">p</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">span</span><span style="color:#F8F8F2;"> {</span><span style="color:#66D9EF;font-style:italic;">display</span><span style="color:#F8F8F2;">:</span><span style="color:#66D9EF;">none</span><span style="color:#F8F8F2;">;}</span></span>
<span class="line"><span style="color:#F92672;">span</span><span style="color:#F8F8F2;"> {</span><span style="color:#66D9EF;font-style:italic;">font-size</span><span style="color:#F8F8F2;">: </span><span style="color:#AE81FF;">14</span><span style="color:#F92672;">px</span><span style="color:#F8F8F2;">;}</span></span>
<span class="line"><span style="color:#F92672;">img</span><span style="color:#F8F8F2;"> {</span><span style="color:#66D9EF;font-style:italic;">float</span><span style="color:#F8F8F2;">: </span><span style="color:#66D9EF;">right</span><span style="color:#F8F8F2;">;}</span></span>
<span class="line"></span></code></pre></div><p>上面这段CSS最终经过一系列步骤后生成的CSSOM：</p><p><img src="https://i.loli.net/2021/08/06/VR9TQ8rw7WCo4EB.png" alt="image.png"></p><p>从图中还可以看出，<code>body</code>节点的子节点继承了<code>body</code>的样式规则（16px的字号）。这就是层叠规则以及CSS为什么叫<u>CSS（层叠样式表）</u>。</p><blockquote><ul><li><p>HTML可以逐步解析，它不需要等待所有DOM都构建完毕后再去构建CSSOM，而是在解析HTML构建DOM时，若遇见CSS会立刻构建CSSOM，它们可以同时进行。</p></li><li><p>但CSS不行，不完整的CSS是无法使用的，因为CSS的每个属性都可以改变CSSOM，所以会存在这样一个问题：假设前面几个字节的CSS将字体大小设置为16px，后面又将字体大小设置为14px，那么如果不把整个CSSOM构建完整，最终得到的CSSOM其实是不准确的。</p></li><li><p>所以必须等CSSOM构建完毕才能进入到下一个阶段，哪怕DOM已经构建完，它也得等CSSOM，然后才能进入下一个阶段。</p></li></ul></blockquote><p><strong>所以，CSS的加载速度与构建CSSOM的速度将直接影响<u>首屏渲染速度，</u>因此在默认情况下CSS被视为阻塞渲染的资源。</strong></p><h2 id="_3-构建渲染树" tabindex="-1"><a class="header-anchor" href="#_3-构建渲染树" aria-hidden="true">#</a> 3. 构建渲染树</h2><div class="language-html ext-html"><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">&lt;!</span><span style="color:#F92672;">doctype</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">html</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">&lt;</span><span style="color:#F92672;">html</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">    &lt;</span><span style="color:#F92672;">head</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">        &lt;</span><span style="color:#F92672;">meta</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">charset</span><span style="color:#F8F8F2;">=</span><span style="color:#E6DB74;">&quot;UTF-8&quot;</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">        &lt;</span><span style="color:#F92672;">title</span><span style="color:#F8F8F2;">&gt;Demos&lt;/</span><span style="color:#F92672;">title</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">        &lt;</span><span style="color:#F92672;">style</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">            </span><span style="color:#F92672;">body</span><span style="color:#F8F8F2;"> {</span><span style="color:#66D9EF;font-style:italic;">font-size</span><span style="color:#F8F8F2;">: </span><span style="color:#AE81FF;">16</span><span style="color:#F92672;">px</span><span style="color:#F8F8F2;">;}</span></span>
<span class="line"><span style="color:#F8F8F2;">            </span><span style="color:#F92672;">p</span><span style="color:#F8F8F2;"> {</span><span style="color:#66D9EF;font-style:italic;">color</span><span style="color:#F8F8F2;">: </span><span style="color:#66D9EF;">red</span><span style="color:#F8F8F2;">;}</span></span>
<span class="line"><span style="color:#F8F8F2;">            </span><span style="color:#F92672;">p</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">span</span><span style="color:#F8F8F2;"> {</span><span style="color:#66D9EF;font-style:italic;">display</span><span style="color:#F8F8F2;">:</span><span style="color:#66D9EF;">none</span><span style="color:#F8F8F2;">;}</span></span>
<span class="line"><span style="color:#F8F8F2;">            </span><span style="color:#F92672;">span</span><span style="color:#F8F8F2;"> {</span><span style="color:#66D9EF;font-style:italic;">font-size</span><span style="color:#F8F8F2;">: </span><span style="color:#AE81FF;">14</span><span style="color:#F92672;">px</span><span style="color:#F8F8F2;">;}</span></span>
<span class="line"><span style="color:#F8F8F2;">            </span><span style="color:#F92672;">img</span><span style="color:#F8F8F2;"> {</span><span style="color:#66D9EF;font-style:italic;">float</span><span style="color:#F8F8F2;">: </span><span style="color:#66D9EF;">right</span><span style="color:#F8F8F2;">;}</span></span>
<span class="line"><span style="color:#F8F8F2;">        &lt;/</span><span style="color:#F92672;">style</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">    &lt;/</span><span style="color:#F92672;">head</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">    &lt;</span><span style="color:#F92672;">body</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">        &lt;</span><span style="color:#F92672;">p</span><span style="color:#F8F8F2;">&gt;Hello &lt;</span><span style="color:#F92672;">span</span><span style="color:#F8F8F2;">&gt;berwin&lt;/</span><span style="color:#F92672;">span</span><span style="color:#F8F8F2;">&gt;&lt;/</span><span style="color:#F92672;">p</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">        &lt;</span><span style="color:#F92672;">span</span><span style="color:#F8F8F2;">&gt;Berwin&lt;/</span><span style="color:#F92672;">span</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">        &lt;</span><span style="color:#F92672;">img</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">src</span><span style="color:#F8F8F2;">=</span><span style="color:#E6DB74;">&quot;https://p1.ssl.qhimg.com/t0195d63bab739ec084.png&quot;</span><span style="color:#F8F8F2;"> /&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">    &lt;/</span><span style="color:#F92672;">body</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">&lt;/</span><span style="color:#F92672;">html</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>这段代码最终构建成渲染树：</p><p><img src="https://i.loli.net/2021/08/06/jaXBDWNPk8TFfCc.png" alt="image.png"></p><ol><li>从 DOM 树的根节点开始遍历每个可见节点。</li><li>有些节点不可见（例如脚本Token、元Token等），因为它们不会体现在渲染输出中，所以会被忽略。</li><li>某些节点被CSS隐藏，因此在渲染树中也会被忽略。例如：上图中的<code>p &gt; span</code>节点就不会出现在渲染树中，因为该节点上设置了<code>display: none</code>属性。</li><li>对于每个可见节点，为其找到适配的 CSSOM 规则并应用它们。</li></ol><p>最终渲染出的结果：</p><p><img src="https://i.loli.net/2021/08/06/ODRKv5IYqEFuyQV.png" alt="image.png"></p><h2 id="_4-布局" tabindex="-1"><a class="header-anchor" href="#_4-布局" aria-hidden="true">#</a> 4. 布局</h2><p>布局流程的输出是一个“盒模型”，它会精确地捕获每个元素在视口内的确切位置和尺寸，所有相对测量值都将转换为屏幕上的绝对像素。</p><p><img src="https://i.loli.net/2021/08/06/sAFXNO2eRhik1CW.png" alt="image.png"></p><h2 id="_5-绘制" tabindex="-1"><a class="header-anchor" href="#_5-绘制" aria-hidden="true">#</a> 5. 绘制</h2><p>布局完成后，浏览器会立即发出“Paint Setup”和“Paint”事件，将渲染树转换成屏幕上的像素。</p><p><img src="https://i.loli.net/2021/08/06/bVeR5FhH3qJslM9.png" alt="image.png"></p><h2 id="_6-js与关键渲染路径" tabindex="-1"><a class="header-anchor" href="#_6-js与关键渲染路径" aria-hidden="true">#</a> 6. JS与关键渲染路径</h2><p><strong>JavaScript的加载、解析与执行会阻塞DOM的构建</strong>，也就是说，在构建DOM时，HTML解析器若遇到了JavaScript，那么它会暂停构建DOM，将控制权移交给JavaScript引擎，等JavaScript引擎运行完毕，浏览器再从中断的地方恢复DOM构建。</p><p>因为JavaScript可以修改网页的内容，它可以更改DOM，如果不阻塞，那么这边在构建DOM，那边JavaScript在改DOM，如何保障最终得到的DOM是否正确？而且在JS中前一秒获取到的DOM和后一秒获取到的DOM不一样是什么鬼？它会产生一系列问题，所以JS是阻塞的，它会阻塞DOM的构建流程，所以在JS中无法获取JS后面的元素，因为DOM还没构建到那。</p><p><u>JavaScript对关键渲染路径的影响不只是阻塞DOM的构建，它会导致<em><strong>CSSOM也阻塞DOM的构建</strong></em>。</u></p><p>原本DOM和CSSOM的构建是互不影响，井水不犯河水，但是一旦引入了JavaScript，CSSOM也开始阻塞DOM的构建，只有CSSOM构建完毕后，DOM再恢复DOM构建。</p><p>假设构建DOM需要一秒，构建CSSOM需要一秒，那么正常情况下只需要一秒钟DOM和CSSOM就会同时构建完毕然后进入到下一个阶段。但是如果引入了JavaScript，那么JavaScript会阻塞DOM的构建并等待CSSOM的下载和构建，一秒钟之后，假设执行JavaScript需要0.00000001秒，那么从中断的地方恢复DOM的构建后，还需要一秒钟的时间才能完成DOM的构建，总共花费了2秒钟才进入到下一个阶段。</p><p>JS阻塞构建DOM并等待CSSOM：</p><p><img src="https://i.loli.net/2021/08/06/elWCXktu3I6NhZQ.png" alt="image.png"></p><p>例如下面不加载JS的代码：</p><div class="language-html ext-html"><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">&lt;!</span><span style="color:#F92672;">doctype</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">html</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">&lt;</span><span style="color:#F92672;">html</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">    &lt;</span><span style="color:#F92672;">head</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">        &lt;</span><span style="color:#F92672;">meta</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">charset</span><span style="color:#F8F8F2;">=</span><span style="color:#E6DB74;">&quot;UTF-8&quot;</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">        &lt;</span><span style="color:#F92672;">title</span><span style="color:#F8F8F2;">&gt;Test&lt;/</span><span style="color:#F92672;">title</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">        &lt;</span><span style="color:#F92672;">link</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">rel</span><span style="color:#F8F8F2;">=</span><span style="color:#E6DB74;">&quot;stylesheet&quot;</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">href</span><span style="color:#F8F8F2;">=</span><span style="color:#E6DB74;">&quot;https://static.xx.fbcdn.net/rsrc.php/v3/y6/l/1,cross/9Ia-Y9BtgQu.css&quot;</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">    &lt;/</span><span style="color:#F92672;">head</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">    &lt;</span><span style="color:#F92672;">body</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">        aa</span></span>
<span class="line"><span style="color:#F8F8F2;">    &lt;/</span><span style="color:#F92672;">body</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">&lt;/</span><span style="color:#F92672;">html</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>上面这段代码的执行性能结果：</p><p><img src="https://i.loli.net/2021/08/06/CaFzmrq2XkItu5U.png" alt="image.png"></p><p>（CSS不阻塞DOM）</p><p>DOMContentLoaded 事件在116ms左右触发。</p><p>在代码中添加JavaScript：</p><div class="language-html ext-html"><pre class="shiki" style="background-color:#272822;"><code><span class="line"><span style="color:#F8F8F2;">&lt;!</span><span style="color:#F92672;">doctype</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">html</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">&lt;</span><span style="color:#F92672;">html</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">    &lt;</span><span style="color:#F92672;">head</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">        &lt;</span><span style="color:#F92672;">meta</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">charset</span><span style="color:#F8F8F2;">=</span><span style="color:#E6DB74;">&quot;UTF-8&quot;</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">        &lt;</span><span style="color:#F92672;">title</span><span style="color:#F8F8F2;">&gt;Test&lt;/</span><span style="color:#F92672;">title</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">        &lt;</span><span style="color:#F92672;">link</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">rel</span><span style="color:#F8F8F2;">=</span><span style="color:#E6DB74;">&quot;stylesheet&quot;</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">href</span><span style="color:#F8F8F2;">=</span><span style="color:#E6DB74;">&quot;https://static.xx.fbcdn.net/rsrc.php/v3/y6/l/1,cross/9Ia-Y9BtgQu.css&quot;</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">    &lt;/</span><span style="color:#F92672;">head</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">    &lt;</span><span style="color:#F92672;">body</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">        aa</span></span>
<span class="line"><span style="color:#F8F8F2;">        &lt;</span><span style="color:#F92672;">script</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">            console.</span><span style="color:#A6E22E;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">        &lt;/</span><span style="color:#F92672;">script</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">    &lt;/</span><span style="color:#F92672;">body</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">&lt;/</span><span style="color:#F92672;">html</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>DOMContentLoaded 事件在1.21s触发：</p><p><img src="https://i.loli.net/2021/08/06/TQo8EtApU7D5v9i.png" alt="image.png"></p><p>（CSS阻塞DOM）</p><h2 id="_7-总结" tabindex="-1"><a class="header-anchor" href="#_7-总结" aria-hidden="true">#</a> 7. 总结</h2><p>关键渲染路径（Critical Rendering Path）是指浏览器将HTML，CSS，JavaScript转换为屏幕上所呈现的实际像素这期间所经历的一系列步骤。</p><p>关键渲染路径共分五个步骤。<u>构建DOM -&gt; 构建CSSOM -&gt; 构建渲染树 -&gt; 布局 -&gt; 绘制</u>。</p><p><strong>CSSOM会阻塞渲染，只有当CSSOM构建完毕后才会进入下一个阶段构建渲染树。</strong></p><p>通常情况下<code>DOM</code>和<code>CSSOM</code>是并行构建的，但是当浏览器遇到一个<code>script</code>标签时，<code>DOM</code>构建将暂停，直至脚本完成执行。但由于<code>JavaScript</code>可以修改<code>CSSOM</code>，所以需要等<code>CSSOM</code>构建完毕后再执行<code>JS</code>。</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><span class="meta-item-info">2021/8/27 下午6:05:33</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 857901398@qq.com">Oops</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main></div><!----><!--]--></div>
    <script type="module" src="/assets/app.d8cb38ab.js" defer></script>
  </body>
</html>
